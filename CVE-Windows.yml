---
- name: Check if KB is installed
  hosts: windows
  vars:
    ansible_port: 5986
    ansible_connection: winrm
    ansible_winrm_transport: basic
    ansible_ssh_port: 5986
    ansible_winrm_server_cert_validation: ignore
    ansible_winrm_kerberos_delegation: yes
  tasks:
  - name: Is this KB Installed?
    win_shell: get-hotfix | out-string -stream | select-string "{{ KB }}"
    register: WIN_CVE

  - set_fact:
      intf: |
        {{ WIN_CVE.stdout.split()[:-1] or "notfound" }}
#              map('regex_findall','*.*') }} # |
#              map('join') }}
  - debug: 
      msg: var="{{ intf[2] }} is installed"
    when: KB == intf[2]

  - debug:
      msg: var="{{ KB }} is not installed"
    when: KB != intf[2] 
